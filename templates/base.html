{% load static %}
<!DOCTYPE html>
<html lang="ja" data-theme="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KokkoSofter</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ç”»åƒãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .image-viewer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(120, 120, 120, 0.8);
      z-index: 10000;
      display: none;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }
    
    /* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ç”¨z-index */
    .tooltip-overlay {
      z-index: 99999 !important;
      position: fixed !important;
    }
    
    /* æŠ•ç¨¿ã‚«ãƒ¼ãƒ‰ç”¨z-index */
    .post-card {
      z-index: 0 !important;
      position: relative !important;
    }
    
    /* æŠ•ç¨¿ã‚«ãƒ¼ãƒ‰ã®ã‚³ãƒ³ãƒ†ãƒŠ */
    .post-container {
      isolation: isolate;
    }
    
    /* ãƒšãƒ¼ã‚¸é·ç§»ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
    .page-transition-overlay {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      background: rgba(0, 0, 0, 0.5) !important;
      backdrop-filter: blur(3px) !important;
      z-index: 99999 !important;
      display: flex !important;
      justify-content: center !important;
      align-items: center !important;
      opacity: 0 !important;
      visibility: hidden !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }
    
    .page-transition-overlay.active {
      opacity: 1 !important;
      visibility: visible !important;
    }
    
    .page-transition-spinner {
      width: 50px !important;
      height: 50px !important;
      border: 3px solid rgba(255, 255, 255, 0.2) !important;
      border-top: 3px solid #ffffff !important;
      border-radius: 50% !important;
      animation: page-spin 0.8s linear infinite !important;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3) !important;
    }
    
    @keyframes page-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* ãƒšãƒ¼ã‚¸é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .page-content {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }
    
    .page-content.transitioning {
      transform: translateY(20px) scale(0.98) !important;
      opacity: 0.6 !important;
      filter: blur(1px) !important;
    }
    
    /* ãƒªãƒ³ã‚¯ãƒ›ãƒãƒ¼åŠ¹æœ */
    .transition-link {
      transition: all 0.2s ease;
    }
    
    .transition-link:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .image-viewer img {
      max-width: 80vw;
      max-height: 80vh;
      width: auto;
      height: auto;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
      cursor: default;
      display: block;
      margin: auto;
    }
    .image-viewer .close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      color: #333;
      font-size: 20px;
      font-weight: bold;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.2s ease;
    }
    .image-viewer .close-btn:hover {
      background: white;
      transform: scale(1.1);
    }
    /* æŠ•ç¨¿ç”»åƒã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .post-image {
      width: 100%;
      max-width: 500px;
      height: auto;
      max-height: 400px;
      object-fit: cover;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .post-image:hover {
      transform: scale(1.02);
    }
    /* ã‚µã‚¤ãƒ‰ãƒãƒ¼å›ºå®šã‚¹ã‚¿ã‚¤ãƒ« */
    .sidebar-sticky {
      position: sticky;
      top: 0;
      max-height: 100vh;
      overflow-y: auto;
      z-index: 100;
      display: flex;
      flex-direction: column;
    }
    
    /* å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .sidebar-left {
      min-height: 100vh;
      position: sticky;
      top: 0;
      align-self: flex-start;
    }
    
    /* å³ã‚µã‚¤ãƒ‰ãƒãƒ¼å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .sidebar-right {
      min-height: 100vh;
      position: sticky;
      top: 0;
      align-self: flex-start;
    }
    
    /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®èƒŒæ™¯ã‚’ç”»é¢ä¸‹ã¾ã§ä¼¸ã°ã™ */
    .sidebar-full-height {
      min-height: 100vh;
      border-radius: 0.5rem;
    }
    
    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ã®èª¿æ•´ */
    .main-content {
      border-radius: 1rem;
      margin: 0.5rem;
      min-height: calc(100vh - 1rem);
    }
    
    /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã‚¹ã‚¿ã‚¤ãƒ« */
    .sidebar-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 45;
      display: none;
    }
    
    .sidebar-backdrop.active {
      display: block;
    }
    
    .sidebar-mobile {
      transform: translateX(-100%);
      transition: transform 0.3s ease-in-out;
    }
    
    .sidebar-mobile.active {
      transform: translateX(0);
    }
    
    @media (min-width: 768px) {
      .sidebar-backdrop {
        display: none !important;
      }
      .sidebar-mobile {
        transform: translateX(0) !important;
      }
    }
    
    /* ãƒ¢ãƒã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .mobile-header {
      display: none;
    }
    
    @media (max-width: 767px) {
      .mobile-header {
        display: flex;
      }
      .desktop-header {
        display: none;
      }
      .sidebar-left {
        display: block !important;
      }
      .main-content {
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding: 1rem;
        max-width: 100% !important;
        margin: 0 !important;
      }
      .sidebar-right {
        display: none !important;
      }
      
      /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
      .modal-box {
        max-width: 95vw !important;
        width: 95vw !important;
      }
      
      #postModalBox {
        width: 95vw !important;
        max-width: 95vw !important;
        height: 85vh !important;
      }
      
      /* æŠ•ç¨¿ç”»åƒã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
      .post-image {
        max-width: 100%;
        height: auto;
      }
    }
  </style>
</head>

<body class="bg-base-200 min-h-screen text-base-content">

  <!-- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="navbar bg-base-200 px-4 desktop-header">
    <div class="flex-1">
      <a href="/" class="inline-block">
        <img id="logo-image" src="{% static 'images/logo.png' %}" alt="KokkoSofter" class="h-12" />
      </a>
      {% if user.is_authenticated %}
        <label for="modal-post" class="btn btn-sm btn-primary h-8 ml-2">ğŸ“ æŠ•ç¨¿</label>
        <span class="ml-4">ã“ã‚“ã«ã¡ã¯ï¼{{ user.username }} ã•ã‚“</span>
      {% else %}
        <label for="modal-login" class="btn btn-sm btn-primary h-8 ml-2">ãƒ­ã‚°ã‚¤ãƒ³</label>
      {% endif %}
    </div>
    <div class="flex-none gap-2">
      <label class="swap swap-rotate cursor-pointer">
        <input type="checkbox" id="theme-toggle" class="theme-controller" />
        <!-- å¤ªé™½ã‚¢ã‚¤ã‚³ãƒ³ (ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰æ™‚è¡¨ç¤º) -->
        <svg class="swap-off fill-current w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/>
        </svg>
        <!-- æœˆã‚¢ã‚¤ã‚³ãƒ³ (ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚è¡¨ç¤º) -->
        <svg class="swap-on fill-current w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
        </svg>
      </label>
      {% if user.is_authenticated %}
        <a href="{% url 'accounts:profile_settings' %}" class="avatar cursor-pointer group relative transition-link">
          <div class="w-8 rounded-full ring-2 ring-primary/30 ring-offset-2 ring-offset-base-100 group-hover:ring-primary transition-all duration-200 hover:scale-110">
            <img src="{{ user.profile.get_avatar_url }}" alt="{{ user.username }}ã‚¢ã‚¤ã‚³ãƒ³" class="rounded-full" />
          </div>
          <!-- ãƒ›ãƒãƒ¼æ™‚ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— -->
          <div class="absolute top-12 right-0 z-[200] invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-all duration-200 transform translate-y-2 group-hover:translate-y-0">
            <div class="bg-base-100 rounded-lg shadow-lg p-3 min-w-[150px] border border-base-content/10">
              <p class="text-sm font-medium">{{ user.username }}</p>
              <p class="text-xs text-base-content/60 mt-1">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š</p>
            </div>
            <!-- ä¸‰è§’å½¢ã®çŸ¢å° -->
            <div class="absolute right-4 -top-2 w-4 h-4 bg-base-100 border-l border-t border-base-content/10 transform rotate-45"></div>
          </div>
        </a>
      {% else %}
        <div class="avatar">
          <div class="w-8 rounded-full">
            <img src="https://i.pravatar.cc/100" />
          </div>
        </div>
      {% endif %}
    </div>
  </header>

  <!-- ãƒ¢ãƒã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="navbar bg-base-200 px-4 mobile-header">
    <div class="flex-none">
      <button id="mobile-menu-btn" class="btn btn-square btn-ghost">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
    <div class="flex-1 flex justify-center">
      <a href="/" class="inline-block">
        <img id="mobile-logo-image" src="{% static 'images/logo.png' %}" alt="KokkoSofter" class="h-10" />
      </a>
    </div>
    <div class="flex-none gap-2">
      <label class="swap swap-rotate cursor-pointer">
        <input type="checkbox" id="mobile-theme-toggle" class="theme-controller" />
        <!-- å¤ªé™½ã‚¢ã‚¤ã‚³ãƒ³ -->
        <svg class="swap-off fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/>
        </svg>
        <!-- æœˆã‚¢ã‚¤ã‚³ãƒ³ -->
        <svg class="swap-on fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
        </svg>
      </label>
      {% if user.is_authenticated %}
        <a href="{% url 'accounts:profile_settings' %}" class="avatar cursor-pointer transition-link">
          <div class="w-8 rounded-full">
            <img src="{{ user.profile.get_avatar_url }}" alt="{{ user.username }}ã®ã‚¢ã‚¤ã‚³ãƒ³" class="rounded-full" />
          </div>
        </a>
      {% else %}
        <label for="modal-login" class="btn btn-sm btn-primary">ãƒ­ã‚°ã‚¤ãƒ³</label>
      {% endif %}
    </div>
  </header>

  <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒãƒƒã‚¯ãƒ‰ãƒ­ãƒƒãƒ— -->
  <div id="sidebar-backdrop" class="sidebar-backdrop"></div>

  <!-- ãƒšãƒ¼ã‚¸é·ç§»ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
  <div id="page-transition-overlay" class="page-transition-overlay">
    <div class="flex flex-col items-center">
      <div class="page-transition-spinner mb-4"></div>
      <p class="text-white text-sm font-medium">èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>
  </div>

  <div class="flex min-h-screen bg-base-200 relative page-content" id="page-content">

    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <aside id="mobile-sidebar" class="w-60 bg-base-300 p-4 rounded-lg shadow-lg sidebar-sticky sidebar-left sidebar-mobile sidebar-full-height fixed md:sticky md:top-0 z-50 md:h-auto h-full">
      <div class="h-full flex flex-col">
      <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¯ãƒ­ãƒ¼ã‚ºãƒœã‚¿ãƒ³ -->
      <div class="flex justify-between items-center md:hidden mb-4 flex-shrink-0">
        <h2 class="text-lg font-bold">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
        <button id="mobile-close-btn" class="btn btn-square btn-ghost btn-sm">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      {% if user.is_authenticated %}
        <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ± -->
        <div class="mb-6 p-3 bg-base-100 rounded-lg">
          <div class="flex items-center space-x-3 mb-3">
            <div class="avatar">
              <div class="w-12 rounded-full">
                <img src="{{ user.profile.get_avatar_url }}" alt="{{ user.username }}ã®ã‚¢ã‚¤ã‚³ãƒ³" />
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <p class="font-semibold truncate">{{ user.username }}</p>
              <p class="text-xs text-base-content/60 truncate">
                {% if user.first_name or user.last_name %}
                  {{ user.first_name }} {{ user.last_name }}
                {% else %}
                  KokkoSoftã®ãƒ¡ãƒ³ãƒãƒ¼
                {% endif %}
              </p>
            </div>
          </div>
          <a href="{% url 'accounts:profile_settings' %}" class="btn btn-xs btn-outline w-full transition-link">
            âš™ï¸ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š
          </a>
        </div>
      {% endif %}

      <div class="flex-grow">
        <nav class="bg-base-100 p-3 rounded-lg mb-4">
          <h3 class="text-sm font-semibold mb-3 text-base-content flex items-center">
            ğŸ“± <span class="ml-2">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
          </h3>
          <ul class="menu text-base space-y-1">
            <li><a href="/" class="rounded-lg hover:bg-primary hover:text-primary-content transition-colors text-base-content transition-link">ğŸ  ãƒ›ãƒ¼ãƒ </a></li>
            <li><label for="modal-post" class="cursor-pointer rounded-lg hover:bg-primary hover:text-primary-content transition-colors text-base-content">ğŸ“ æ–°è¦æŠ•ç¨¿</label></li>
            <li><a class="rounded-lg hover:bg-primary hover:text-primary-content transition-colors text-base-content">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a></li>
            <li><a class="rounded-lg hover:bg-primary hover:text-primary-content transition-colors text-base-content">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ç½®ãå ´</a></li>
            <li><a class="rounded-lg hover:bg-primary hover:text-primary-content transition-colors text-base-content">âœ… Todoãƒªã‚¹ãƒˆ</a></li>
            <li><a href="{% url 'accounts:profile_settings' %}" class="rounded-lg hover:bg-primary hover:text-primary-content transition-colors text-base-content transition-link">âš™ï¸ è¨­å®š</a></li>
          </ul>
        </nav>
        
        <div class="mt-4 space-y-2">
          {% if user.is_authenticated %}
            <label for="modal-post" class="btn btn-primary btn-sm w-full shadow-lg">
              âœ¨ æ–°è¦æŠ•ç¨¿
            </label>
            <label for="logout-modal" class="btn btn-outline btn-sm w-full">
              ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            </label>
          {% else %}
            <label for="modal-login" class="btn btn-primary btn-sm w-full shadow-lg">
              ğŸ” ãƒ­ã‚°ã‚¤ãƒ³
            </label>
          {% endif %}
        </div>
      </div>
        
      <!-- ãƒ•ã‚£ãƒ©ãƒ¼ï¼ˆä½™ç™½ã‚’åŸ‹ã‚ã¦èƒŒæ™¯ã‚’ä¸‹ã¾ã§ä¼¸ã°ã™ï¼‰ -->
      <div class="flex-grow"></div>
      </div>
    </aside>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="max-w-3xl w-full mx-auto p-6 rounded-xl shadow-lg overflow-hidden main-content bg-base-100 border border-base-content/10">
      {% block page_title %}
        <!-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¡¨ç¤ºã—ãªã„ -->
      {% endblock %}
      {% block content %}{% endblock %}
    </main>

    <!-- å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <aside class="w-60 bg-base-300 p-4 rounded-lg shadow-lg sidebar-sticky sidebar-right sidebar-full-height">
      <div class="h-full flex flex-col">
        <div class="bg-base-100 p-3 rounded-lg mb-4">
          <h2 class="text-lg font-bold mb-3 text-success flex items-center">
            ğŸŸ¢ <span class="ml-2">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</span>
          </h2>
          <ul class="space-y-2">
            <li class="flex items-center space-x-2">
              <span class="badge badge-error badge-xs"></span>
              <span>ã¯ãŸã­</span>
            </li>
            <li class="flex items-center space-x-2">
              <span class="badge badge-primary badge-xs"></span>
              <span>ãµã‚‰ã‚ã‚“</span>
            </li>
            <li class="flex items-center space-x-2">
              <span class="badge badge-warning badge-xs"></span>
              <span>ã„ã›ãˆã³</span>
            </li>
            <li class="flex items-center space-x-2">
              <span class="badge badge-secondary badge-xs"></span>
              <span>ã•ã•ãŠã‹</span>
            </li>
            <li class="flex items-center space-x-2">
              <span class="badge badge-info badge-xs"></span>
              <span>ã©ã‚ã·ã™</span>
            </li>
          </ul>
        </div>
        
        <div class="bg-base-100 p-3 rounded-lg mb-4">
          <h2 class="text-lg font-bold mb-3 text-warning flex items-center">
            ğŸ”” <span class="ml-2">é€šçŸ¥</span>
          </h2>
          <ul class="space-y-2 text-sm">
            <li class="p-2 bg-base-100/50 rounded border-l-4 border-primary">
              @ã„ã›ãˆã³ ãŒã‚ãªãŸã‚’ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã—ã¾ã—ãŸ
            </li>
            <li class="p-2 bg-base-100/50 rounded border-l-4 border-secondary">
              ã€Œã†ã‚“ã“ã€€ã†ã‚“ã“ã€ã®äºˆå®šãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ
            </li>
          </ul>
        </div>
        
        <!-- ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆ -->
        <div class="bg-base-100 p-3 rounded-lg mb-4 text-center">
          <h3 class="text-sm font-semibold mb-3 flex items-center justify-center text-accent">
            ğŸ• <span class="ml-2">ç¾åœ¨æ™‚åˆ»</span>
          </h3>
          <div id="digital-clock" class="text-xl font-mono font-bold text-primary mb-1">
            --:--:--
          </div>
          <div id="digital-date" class="text-sm text-base-content/70">
            ----å¹´--æœˆ--æ—¥
          </div>
        </div>

        <!-- å¤©æ°—æƒ…å ± -->
        <div class="bg-base-100 p-3 rounded-lg mb-4">
          <h3 class="text-sm font-semibold mb-3 flex items-center text-info">
            ğŸŒ¤ï¸ <span class="ml-2">å¤©æ°—æƒ…å ±</span>
          </h3>
          <div id="weather-content">
            <div id="weather-loading" class="text-sm text-base-content/60 text-center">
              <span class="loading loading-spinner loading-sm mr-2"></span>
              ä½ç½®æƒ…å ±ã‚’å–å¾—ä¸­...
            </div>
            <div id="weather-data" class="hidden">
              <div class="text-sm">
                <div id="weather-location" class="font-medium text-primary mb-1"></div>
                <div id="weather-area" class="text-xs text-base-content/70 mb-2"></div>
                <div id="weather-desc" class="text-base-content/80 mb-2 p-2 bg-base-100/50 rounded"></div>
                <div id="weather-temp" class="text-lg font-bold text-accent"></div>
                <div id="weather-time" class="text-xs text-base-content/60 mt-1"></div>
              </div>
            </div>
            <div id="weather-error" class="hidden text-sm text-error">
              å¤©æ°—æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ
              <button id="weather-retry" class="btn btn-xs btn-outline btn-primary ml-2">å†è©¦è¡Œ</button>
            </div>
          </div>
        </div>
        
        <!-- ãƒ‡ãƒãƒƒã‚°ç”¨ãƒœã‚¿ãƒ³ï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰ -->
        <div class="bg-base-100 p-3 rounded-lg mb-4">
          <h3 class="text-sm font-semibold mb-3 flex items-center text-warning">
            ğŸ”§ <span class="ml-2">ãƒ‡ãƒãƒƒã‚°</span>
                <span class="text-xs text-base-content/60 ml-2">(é–‹ç™ºè€…å‘ã‘)</span>
            </h3>
          <button onclick="testTransition()" class="btn btn-xs btn-outline btn-warning w-full">
            é·ç§»ãƒ†ã‚¹ãƒˆ
          </button>
        </div>
        
        <!-- ãƒ•ã‚£ãƒ©ãƒ¼ï¼ˆä½™ç™½ã‚’åŸ‹ã‚ã¦èƒŒæ™¯ã‚’ä¸‹ã¾ã§ä¼¸ã°ã™ï¼‰ -->
        <div class="flex-grow"></div>
      </div>
    </aside>
  </div>

  <!-- ç”»åƒãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ -->
  <div class="image-viewer" id="imageViewer">
    <button class="close-btn" onclick="closeImageViewer()">Ã—</button>
    <img id="viewerImage" src="" alt="æ‹¡å¤§ç”»åƒ" />
  </div>

  <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <input type="checkbox" id="modal-login" class="modal-toggle" {% if form.errors %}checked{% endif %} />
  <div class="modal">
    <div id="modal-loginBox" class="modal-box relative max-w-md w-full">
      <label for="modal-login" class="btn btn-sm btn-circle absolute right-2 top-2">âœ•</label>
      <h3 class="font-bold text-lg drag-handle cursor-move mb-4">ãƒ­ã‚°ã‚¤ãƒ³</h3>
      <form method="post" action="{% url 'accounts:login' %}" class="space-y-4">
        {% csrf_token %}
        <input type="text" name="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" class="input input-bordered w-full" required />
        <input type="password" name="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" class="input input-bordered w-full" required />
        <button type="submit" class="btn btn-primary w-full">ãƒ­ã‚°ã‚¤ãƒ³</button>
        {% if form.errors %}
          <p class="text-red-500">ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚</p>
        {% endif %}
      </form>
    </div>
  </div>

  <!-- æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <input type="checkbox" id="modal-post" class="modal-toggle" />
  <div class="modal">
    <div id="postModalBox" class="modal-box relative w-[90vw] max-w-4xl h-[80vh] overflow-hidden">
      <label for="modal-post" class="btn btn-sm btn-circle absolute right-2 top-2">âœ•</label>
      <h3 class="font-bold text-lg drag-handle cursor-move mb-4">âœï¸ æ–°è¦æŠ•ç¨¿</h3>
      
      <form method="post" action="{% url 'posts:create' %}" enctype="multipart/form-data"
            class="flex flex-col h-[calc(100%-4rem)] space-y-4">
        {% csrf_token %}
        
        <!-- ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ -->
        <div class="form-control flex-grow">
          <label class="label">
            <span class="label-text font-semibold">æŠ•ç¨¿å†…å®¹</span>
            <span class="label-text-alt" id="post-char-count">0 / 1000æ–‡å­—</span>
          </label>
          <div class="relative flex-grow">
            <textarea name="content" id="post-content" placeholder="é€²æ—ã¨ã‹é›‘è«‡ã¨ã‹" 
                      class="textarea textarea-bordered w-full h-full resize-none text-base leading-relaxed p-4" 
                      maxlength="1000" required></textarea>
            <div class="absolute bottom-3 right-3 text-xs text-base-content/40">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
              </svg>
            </div>
          </div>
        </div>
        
        <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">ç”»åƒãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ï¼ˆä»»æ„ï¼‰</span>
          </label>
          
          <div class="relative">
            <input type="file" name="image" id="post-image-input" class="hidden" accept="image/*" />
            
            <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ï¼ˆç”»åƒé¸æŠå¾Œã«è¡¨ç¤ºï¼‰ -->
            <div id="image-preview" class="hidden mb-4 p-4 bg-base-200 rounded-lg border border-base-content/10">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-success">ğŸ’¾ ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ·»ä»˜ã•ã‚Œã¾ã—ãŸ</span>
                <button type="button" id="remove-image" class="btn btn-xs btn-error btn-outline">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  å‰Šé™¤
                </button>
              </div>
              <div class="flex items-center space-x-3">
                <img id="preview-image" src="" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" class="w-16 h-16 object-cover rounded-lg" />
                <div>
                  <p id="image-name" class="text-sm font-medium"></p>
                  <p id="image-size" class="text-xs text-base-content/60"></p>
                </div>
              </div>
            </div>
            
            <!-- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¨ãƒªã‚¢ -->
            <div id="post-drop-zone" class="border-2 border-dashed border-base-content/20 rounded-lg p-8 text-center hover:border-primary/60 hover:bg-primary/5 transition-all duration-300 cursor-pointer group" onclick="document.getElementById('post-image-input').click()">
              <div class="transition-all duration-300 group-hover:scale-105">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-base-content/30 group-hover:text-primary/70 mb-3 transition-colors duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <p class="text-base-content/60 mb-1 font-medium group-hover:text-primary/80 transition-colors">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
                <p class="text-sm text-base-content/40 group-hover:text-primary/60 transition-colors">ã¾ãŸã¯ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
              </div>
              
              <!-- ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
              <div id="post-drag-overlay" class="absolute inset-0 bg-primary/10 border-2 border-primary rounded-lg flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-200">
                <div class="text-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto text-primary mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                  </svg>
                  <p class="font-bold text-primary">ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—ï¼</p>
                </div>
              </div>
            </div>
            
            <div class="mt-2 text-xs text-base-content/60 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              JPG, PNG, GIF, PDF, DOCå½¢å¼ / æœ€å¤§10MB
            </div>
          </div>
        </div>
        
        <!-- æŠ•ç¨¿ãƒœã‚¿ãƒ³ -->
        <div class="flex space-x-3 pt-2">
          <label for="modal-post" class="btn btn-outline flex-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
          </label>
          <button type="submit" class="btn btn-primary flex-1" id="post-submit-btn">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
            </svg>
            æŠ•ç¨¿ã™ã‚‹
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <input type="checkbox" id="logout-modal" class="modal-toggle" />
  <div class="modal">
    <div id="logout-modalBox" class="modal-box max-w-md">
      <h3 class="font-bold text-lg">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ</h3>
      <p class="py-4">æœ¬å½“ã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
      <div class="modal-action">
        <label for="logout-modal" class="btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</label>
        <form method="post" action="{% url 'accounts:logout' %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-error">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </form>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const modals = [
        { id: 'modal-login', box: 'modal-loginBox' },
        { id: 'modal-post', box: 'postModalBox' },
        { id: 'logout-modal', box: 'logout-modalBox' }
      ];

      modals.forEach(({ id, box }) => {
        const modalInput = document.getElementById(id);
        const modalBox = document.getElementById(box);
        const modal = modalInput ? modalInput.closest('.modal') : null;

        if (modalInput && modalBox && modal) {
          // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              modalInput.checked = false;
            }
          });
          
          // ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒœãƒƒã‚¯ã‚¹è‡ªä½“ã®ã‚¯ãƒªãƒƒã‚¯ã‚’åœæ­¢ï¼ˆèƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šã‚’é˜²ãï¼‰
          modalBox.addEventListener('click', (e) => {
            e.stopPropagation();
          });
        }
      });

      // ãƒ‰ãƒ©ãƒƒã‚°ç§»å‹•ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãƒ»æŠ•ç¨¿ï¼‰
      function enableDrag(modalBoxId) {
        const modalBox = document.getElementById(modalBoxId);
        if (!modalBox) return;
        const header = modalBox.querySelector('.drag-handle');
        if (!header) return;
        
        let isDragging = false, offsetX = 0, offsetY = 0;

        header.addEventListener('mousedown', (e) => {
          isDragging = true;
          const rect = modalBox.getBoundingClientRect();
          offsetX = e.clientX - rect.left;
          offsetY = e.clientY - rect.top;
          modalBox.style.position = 'fixed';
          modalBox.style.left = `${rect.left}px`;
          modalBox.style.top = `${rect.top}px`;
          modalBox.style.margin = '0';
          modalBox.style.transform = 'none';
          modalBox.style.zIndex = 9999;
        });

        document.addEventListener('mousemove', (e) => {
          if (!isDragging) return;
          modalBox.style.left = `${e.clientX - offsetX}px`;
          modalBox.style.top = `${e.clientY - offsetY}px`;
        });

        document.addEventListener('mouseup', () => {
          isDragging = false;
        });
      }

      enableDrag('modal-loginBox');
      enableDrag('postModalBox');

      // ç”»åƒãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼æ©Ÿèƒ½ã‚’åˆæœŸåŒ–
      setupImageViewer();

      // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®ä½ç½®èª¿æ•´
      setupTooltipPositioning();

      // ã„ã„ã­ãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½
      setupLikeButtons();

      // å¤©æ°—æƒ…å ±ã‚’åˆæœŸåŒ–
      setupWeatherRetry();
      loadWeatherInfo();

      // ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆã‚’åˆæœŸåŒ–
      initDigitalClock();

      // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã‚’åˆæœŸåŒ–
      initThemeToggle();

      // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹æ©Ÿèƒ½
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          // é–‹ã„ã¦ã„ã‚‹ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
          modals.forEach(({ id }) => {
            const modalInput = document.getElementById(id);
            if (modalInput && modalInput.checked) {
              modalInput.checked = false;
            }
          });
        }
      });
    });

    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®ä½ç½®èª¿æ•´æ©Ÿèƒ½
    function setupTooltipPositioning() {
      const avatars = document.querySelectorAll('.avatar.cursor-pointer.relative.group');
      
      avatars.forEach(avatar => {
        const tooltip = avatar.querySelector('.tooltip-overlay');
        if (!tooltip) return;
        
        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’bodyã®ç›´ä¸‹ã«ç§»å‹•ï¼ˆãƒãƒ¼ã‚¿ãƒ«åŒ–ï¼‰
        document.body.appendChild(tooltip);
        
        let hoverTimeout;
        let isVisible = false;
        
        avatar.addEventListener('mouseenter', function() {
          // 1ç§’å¾Œã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’è¡¨ç¤º
          hoverTimeout = setTimeout(() => {
            const rect = this.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 10) + 'px';
            tooltip.style.display = 'block';
            tooltip.style.opacity = '1';
            tooltip.style.transform = 'translateY(0)';
            isVisible = true;
          }, 1000); // 1ç§’ã®é…å»¶
        });
        
        avatar.addEventListener('mouseleave', function() {
          // ãƒ›ãƒãƒ¼çµ‚äº†æ™‚ã¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¦å³åº§ã«éè¡¨ç¤º
          clearTimeout(hoverTimeout);
          
          if (isVisible) {
            tooltip.style.opacity = '0';
            tooltip.style.transform = 'translateY(8px)';
            setTimeout(() => {
              tooltip.style.display = 'none';
              isVisible = false;
            }, 300);
          }
        });
      });
    }

    // ç”»åƒãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    function setupImageViewer() {
      const images = document.querySelectorAll('.post-image');
      
      images.forEach(img => {
        if (!img.hasAttribute('data-viewer-attached')) {
          img.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            openImageViewer(img.src);
          });
          img.setAttribute('data-viewer-attached', 'true');
        }
      });

      // ç”»åƒãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã®èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
      const viewer = document.getElementById('imageViewer');
      if (viewer) {
        viewer.addEventListener('click', (e) => {
          if (e.target === viewer) {
            closeImageViewer();
          }
        });
      }

      // ESCã‚­ãƒ¼ã§ç”»åƒãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‚’é–‰ã˜ã‚‹
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeImageViewer();
        }
      });
    }

    // ç”»åƒãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‚’é–‹ã
    function openImageViewer(imageSrc) {
      const viewer = document.getElementById('imageViewer');
      const viewerImage = document.getElementById('viewerImage');
      
      if (viewer && viewerImage && imageSrc) {
        viewerImage.src = imageSrc;
        viewer.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // ç”»åƒã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã¤
        viewerImage.onload = function() {
          // ç”»åƒãŒéå¸¸ã«å¤§ãã„å ´åˆã®è¿½åŠ åˆ¶é™
          const naturalWidth = this.naturalWidth;
          const naturalHeight = this.naturalHeight;
          const maxDisplayWidth = window.innerWidth * 0.8;
          const maxDisplayHeight = window.innerHeight * 0.8;
          
          if (naturalWidth > maxDisplayWidth || naturalHeight > maxDisplayHeight) {
            const ratio = Math.min(maxDisplayWidth / naturalWidth, maxDisplayHeight / naturalHeight);
            this.style.width = (naturalWidth * ratio) + 'px';
            this.style.height = (naturalHeight * ratio) + 'px';
          }
        };
      }
    }

    // ç”»åƒãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‚’é–‰ã˜ã‚‹
    function closeImageViewer() {
      const viewer = document.getElementById('imageViewer');
      const viewerImage = document.getElementById('viewerImage');
      
      if (viewer) {
        viewer.style.display = 'none';
        document.body.style.overflow = 'auto';
        
        if (viewerImage) {
          viewerImage.src = '';
          viewerImage.style.width = 'auto';
          viewerImage.style.height = 'auto';
        }
      }
    }

    // ã„ã„ã­ãƒœã‚¿ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    function setupLikeButtons() {
      document.querySelectorAll('.post-like-btn').forEach(button => {
        button.addEventListener('click', async (e) => {
          e.preventDefault();

          const postId = button.dataset.postId;
          const url = `/posts/like/${postId}/`;

          try {
            const response = await fetch(url, {
              method: 'POST',
              headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({}),
            });

            if (!response.ok) throw new Error('Network response was not ok');

            const data = await response.json();

            // ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’æ›´æ–°
            button.querySelector('.like-count').textContent = data.like_count;

            if (data.liked) {
              button.classList.add('btn-primary');
              button.classList.remove('btn-outline');
            } else {
              button.classList.remove('btn-primary');
              button.classList.add('btn-outline');
            }
          } catch (error) {
            console.error('Error:', error);
          }
        });
      });
    }

    // CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’cookieã‹ã‚‰å–å¾—ã™ã‚‹é–¢æ•°
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
          cookie = cookie.trim();
          if (cookie.startsWith(name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // å¤©æ°—æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    async function fetchWeatherData(lat, lon) {
      try {
        const response = await fetch('/api/weather/', {
          method: 'POST',
          headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ lat: lat, lon: lon }),
        });

        if (!response.ok) throw new Error('Network response was not ok');
        return await response.json();
      } catch (error) {
        console.error('Weather API error:', error);
        return { success: false, error: error.message };
      }
    }

    // ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ã¦å¤©æ°—ã‚’è¡¨ç¤º
    function loadWeatherInfo() {
      const loadingEl = document.getElementById('weather-loading');
      const dataEl = document.getElementById('weather-data');
      const errorEl = document.getElementById('weather-error');

      if (!navigator.geolocation) {
        loadingEl.classList.add('hidden');
        errorEl.classList.remove('hidden');
        errorEl.textContent = 'ä½ç½®æƒ…å ±ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“';
        return;
      }

      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;

          const result = await fetchWeatherData(lat, lon);

          loadingEl.classList.add('hidden');

          if (result.success && result.data) {
            const weather = result.data;
            
            // éƒ½é“åºœçœŒãƒ»å¸‚ç”ºæ‘åã‚’è¡¨ç¤º
            const locationText = [weather.prefecture, weather.city].filter(Boolean).join(' ');
            document.getElementById('weather-location').textContent = locationText || 'ä½ç½®ä¸æ˜';
            
            document.getElementById('weather-area').textContent = weather.area_name || 'åœ°åŸŸä¸æ˜';
            document.getElementById('weather-desc').textContent = weather.weather || 'æƒ…å ±ãªã—';
            document.getElementById('weather-temp').textContent = weather.temperature || '';
            
            // æ›´æ–°æ™‚é–“ã‚’è¡¨ç¤º
            if (weather.update_time) {
              const updateTime = new Date(weather.update_time);
              const timeStr = updateTime.toLocaleString('ja-JP', {
                month: 'numeric',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
              });
              document.getElementById('weather-time').textContent = `æ›´æ–°: ${timeStr}`;
            }

            dataEl.classList.remove('hidden');
          } else {
            errorEl.classList.remove('hidden');
            if (result.error) {
              errorEl.firstChild.textContent = result.error;
            }
          }
        },
        (error) => {
          loadingEl.classList.add('hidden');
          errorEl.classList.remove('hidden');
          
          let errorMessage = 'ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
          switch (error.code) {
            case error.PERMISSION_DENIED:
              errorMessage = 'ä½ç½®æƒ…å ±ã®å–å¾—ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ';
              break;
            case error.POSITION_UNAVAILABLE:
              errorMessage = 'ä½ç½®æƒ…å ±ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“';
              break;
            case error.TIMEOUT:
              errorMessage = 'ä½ç½®æƒ…å ±ã®å–å¾—ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ';
              break;
          }
          
          errorEl.firstChild.textContent = errorMessage;
        },
        {
          timeout: 10000,
          enableHighAccuracy: false,
          maximumAge: 600000 // 10åˆ†é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
        }
      );
    }

    // å¤©æ°—æƒ…å ±å†è©¦è¡Œãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    function setupWeatherRetry() {
      const retryBtn = document.getElementById('weather-retry');
      if (retryBtn) {
        retryBtn.addEventListener('click', () => {
          document.getElementById('weather-loading').classList.remove('hidden');
          document.getElementById('weather-data').classList.add('hidden');
          document.getElementById('weather-error').classList.add('hidden');
          loadWeatherInfo();
        });
      }
    }

    // ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆã®æ›´æ–°
    function updateDigitalClock() {
      const now = new Date();
      
      // æ™‚åˆ»è¡¨ç¤º (HH:MM:SS)
      const timeString = now.toLocaleTimeString('ja-JP', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      });
      
      // æ—¥ä»˜è¡¨ç¤º (YYYYå¹´MMæœˆDDæ—¥ æ›œæ—¥)
      const dateString = now.toLocaleDateString('ja-JP', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'short'
      });
      
      const clockEl = document.getElementById('digital-clock');
      const dateEl = document.getElementById('digital-date');
      
      if (clockEl) clockEl.textContent = timeString;
      if (dateEl) dateEl.textContent = dateString;
    }

    // ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆã‚’åˆæœŸåŒ–
    function initDigitalClock() {
      updateDigitalClock(); // å³åº§ã«æ›´æ–°
      setInterval(updateDigitalClock, 1000); // 1ç§’ã”ã¨ã«æ›´æ–°
    }

    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
    function initThemeToggle() {
      const themeToggle = document.getElementById('theme-toggle');
      const htmlElement = document.documentElement;
      
      // ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ†ãƒ¼ãƒã‚’å–å¾—
      function getSystemTheme() {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }
      
      // ä¿å­˜ã•ã‚ŒãŸãƒ†ãƒ¼ãƒã¾ãŸã¯ã‚·ã‚¹ãƒ†ãƒ ãƒ†ãƒ¼ãƒã‚’å–å¾—
      function getCurrentTheme() {
        const savedTheme = localStorage.getItem('theme');
        return savedTheme || getSystemTheme();
      }
      
      // ãƒ†ãƒ¼ãƒã‚’é©ç”¨
      function applyTheme(theme) {
        const logoImage = document.getElementById('logo-image');
        const mobileLogoImage = document.getElementById('mobile-logo-image');
        
        if (theme === 'dark') {
          htmlElement.setAttribute('data-theme', 'dark');
          themeToggle.checked = true;
          if (logoImage) {
            logoImage.src = "{% static 'images/logo.png' %}";
          }
          if (mobileLogoImage) {
            mobileLogoImage.src = "{% static 'images/logo.png' %}";
          }
        } else {
          htmlElement.setAttribute('data-theme', 'light');
          themeToggle.checked = false;
          if (logoImage) {
            logoImage.src = "{% static 'images/logo1.png' %}";
          }
          if (mobileLogoImage) {
            mobileLogoImage.src = "{% static 'images/logo1.png' %}";
          }
        }
        localStorage.setItem('theme', theme);
      }
      
      // åˆæœŸãƒ†ãƒ¼ãƒã‚’è¨­å®š
      const currentTheme = getCurrentTheme();
      applyTheme(currentTheme);
      
      // ãƒ¢ãƒã‚¤ãƒ«ãƒ†ãƒ¼ãƒãƒˆã‚°ãƒ«ã‚‚åŒæœŸ
      const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
      if (mobileThemeToggle) {
        mobileThemeToggle.checked = (currentTheme === 'dark');
      }
      
      // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã‚¤ãƒ™ãƒ³ãƒˆ
      themeToggle.addEventListener('change', function() {
        const newTheme = this.checked ? 'dark' : 'light';
        applyTheme(newTheme);
        
        // ãƒ¢ãƒã‚¤ãƒ«ãƒˆã‚°ãƒ«ã‚‚åŒæœŸ
        const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
        if (mobileThemeToggle) {
          mobileThemeToggle.checked = this.checked;
        }
      });
      
      // ã‚·ã‚¹ãƒ†ãƒ ãƒ†ãƒ¼ãƒå¤‰æ›´ã®ç›£è¦–
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
        // ä¿å­˜ã•ã‚ŒãŸãƒ†ãƒ¼ãƒãŒãªã„å ´åˆã®ã¿ã‚·ã‚¹ãƒ†ãƒ ãƒ†ãƒ¼ãƒã«å¾“ã†
        if (!localStorage.getItem('theme')) {
          applyTheme(e.matches ? 'dark' : 'light');
        }
      });
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã¨æ–°ã—ã„ç”»åƒè¿½åŠ æ™‚ã«å‘¼ã³å‡ºã™é–¢æ•°
    function refreshImageViewer() {
      setupImageViewer();
    }

    // æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ«ã®æ©Ÿèƒ½ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    function setupPostModal() {
      const contentTextarea = document.getElementById('post-content');
      const charCount = document.getElementById('post-char-count');
      const dropZone = document.getElementById('post-drop-zone');
      const dragOverlay = document.getElementById('post-drag-overlay');
      const fileInput = document.getElementById('post-image-input');
      const imagePreview = document.getElementById('image-preview');
      const previewImage = document.getElementById('preview-image');
      const imageName = document.getElementById('image-name');
      const imageSize = document.getElementById('image-size');
      const removeImageBtn = document.getElementById('remove-image');
      const postSubmitBtn = document.getElementById('post-submit-btn');
      const postForm = postSubmitBtn ? postSubmitBtn.closest('form') : null;

      // æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®é·ç§»åŠ¹æœ
      if (postForm && postSubmitBtn) {
        postForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
          const content = contentTextarea ? contentTextarea.value.trim() : '';
          if (!content) {
            alert('æŠ•ç¨¿å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
          }
          
          // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
          postSubmitBtn.disabled = true;
          postSubmitBtn.innerHTML = `
            <span class="loading loading-spinner loading-sm mr-2"></span>
            æŠ•ç¨¿ä¸­...
          `;
          
          // ãƒšãƒ¼ã‚¸é·ç§»åŠ¹æœã‚’è¡¨ç¤º
          showPageTransition();
          
          // å°‘ã—é…å»¶ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
          setTimeout(() => {
            this.submit();
          }, 500);
        });
      }

      // ...existing code...
      if (contentTextarea && charCount) {
        function updateCharCount() {
          const currentLength = contentTextarea.value.length;
          const maxLength = 1000;
          
          charCount.textContent = `${currentLength} / ${maxLength}æ–‡å­—`;
          
          if (currentLength > maxLength * 0.9) {
            charCount.classList.add('text-warning');
          } else {
            charCount.classList.remove('text-warning');
          }
          
          if (currentLength > maxLength) {
            charCount.classList.add('text-error');
            charCount.classList.remove('text-warning');
          } else {
            charCount.classList.remove('text-error');
          }
        }
        
        updateCharCount();
        contentTextarea.addEventListener('input', updateCharCount);
      }

      // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½
      if (dropZone && fileInput) {
        let dragCounter = 0;
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
          dropZone.addEventListener(eventName, preventDefaults, false);
          document.body.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }
        
        dropZone.addEventListener('dragenter', function(e) {
          dragCounter++;
          if (dragOverlay) {
            dragOverlay.style.opacity = '1';
          }
        });
        
        dropZone.addEventListener('dragleave', function(e) {
          dragCounter--;
          if (dragCounter <= 0 && dragOverlay) {
            dragOverlay.style.opacity = '0';
          }
        });
        
        dropZone.addEventListener('drop', function(e) {
          dragCounter = 0;
          if (dragOverlay) {
            dragOverlay.style.opacity = '0';
          }
          handleFileDrop(e);
        });
        
        function handleFileDrop(e) {
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            handleFileSelect(files[0]);
          }
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚ã®å‡¦ç†
        fileInput.addEventListener('change', function(e) {
          if (e.target.files.length > 0) {
            handleFileSelect(e.target.files[0]);
          }
        });
        
        function handleFileSelect(file) {
          if (!file.type.startsWith('image/')) {
            alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‹PDFã€DOCãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼');
            return;
          }
          
          if (file.size > 10 * 1024 * 1024) { // 10MBåˆ¶é™
            alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º10MBä»¥ä¸‹ã§ãŠé¡˜ã„ã—ã¾ã™ğŸ™');
            return;
          }
          
          // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
          if (imagePreview && previewImage && imageName && imageSize) {
            const reader = new FileReader();
            reader.onload = function(e) {
              previewImage.src = e.target.result;
              imageName.textContent = file.name;
              imageSize.textContent = (file.size / 1024 / 1024).toFixed(2) + 'MB';
              
              imagePreview.classList.remove('hidden');
              dropZone.classList.add('hidden');
            };
            reader.readAsDataURL(file);
          }
          
          // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã«è¨­å®š
          const dt = new DataTransfer();
          dt.items.add(file);
          fileInput.files = dt.files;
        }
        
        // ç”»åƒå‰Šé™¤ãƒœã‚¿ãƒ³
        if (removeImageBtn) {
          removeImageBtn.addEventListener('click', function() {
            fileInput.value = '';
            if (imagePreview && dropZone) {
              imagePreview.classList.add('hidden');
              dropZone.classList.remove('hidden');
            }
          });
        }
      }

      // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‰ã˜ã‚‰ã‚ŒãŸæ™‚ã«ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
      const modalToggle = document.getElementById('modal-post');
      if (modalToggle) {
        modalToggle.addEventListener('change', function() {
          if (!this.checked) {
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‰ã˜ã‚‰ã‚ŒãŸæ™‚
            if (contentTextarea) contentTextarea.value = '';
            if (fileInput) fileInput.value = '';
            if (imagePreview && dropZone) {
              imagePreview.classList.add('hidden');
              dropZone.classList.remove('hidden');
            }
            if (charCount) charCount.textContent = '0 / 1000æ–‡å­—';
          }
        });
      }
    }

    // åˆæœŸåŒ–æ™‚ã«æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    setupPostModal();

    // ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ©Ÿèƒ½
    function setupMobileMenu() {
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileCloseBtn = document.getElementById('mobile-close-btn');
      const mobileSidebar = document.getElementById('mobile-sidebar');
      const sidebarBackdrop = document.getElementById('sidebar-backdrop');

      console.log('Mobile menu setup:', { mobileMenuBtn, mobileCloseBtn, mobileSidebar, sidebarBackdrop });

      function openMobileSidebar() {
        console.log('Opening mobile sidebar');
        if (mobileSidebar && sidebarBackdrop) {
          mobileSidebar.classList.add('active');
          sidebarBackdrop.classList.add('active');
          document.body.style.overflow = 'hidden';
        }
      }

      function closeMobileSidebar() {
        console.log('Closing mobile sidebar');
        if (mobileSidebar && sidebarBackdrop) {
          mobileSidebar.classList.remove('active');
          sidebarBackdrop.classList.remove('active');
          document.body.style.overflow = '';
        }
      }

      if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Mobile menu button clicked');
          openMobileSidebar();
        });
      }

      if (mobileCloseBtn) {
        mobileCloseBtn.addEventListener('click', closeMobileSidebar);
      }

      if (sidebarBackdrop) {
        sidebarBackdrop.addEventListener('click', closeMobileSidebar);
      }

      // ESCã‚­ãƒ¼ã§ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‰ã˜ã‚‹
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeMobileSidebar();
        }
      });
    }

    // ãƒ¢ãƒã‚¤ãƒ«ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆã®åŒæœŸ
    function setupMobileThemeSync() {
      const mobileThemeToggle = document.getElementById('mobile-theme-toggle');

      if (mobileThemeToggle) {
        mobileThemeToggle.addEventListener('change', function() {
          const desktopThemeToggle = document.getElementById('theme-toggle');
          if (desktopThemeToggle) {
            desktopThemeToggle.checked = this.checked;
            // ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç”Ÿã•ã›ã¦ãƒ†ãƒ¼ãƒã‚’é©ç”¨
            desktopThemeToggle.dispatchEvent(new Event('change'));
          }
        });
      }
    }

    // ãƒ¢ãƒã‚¤ãƒ«æ©Ÿèƒ½ã‚’åˆæœŸåŒ–
    setupMobileMenu();
    setupMobileThemeSync();
    
    // ãƒšãƒ¼ã‚¸é·ç§»æ©Ÿèƒ½ã‚’åˆæœŸåŒ–
    setupPageTransitions();
  </script>

  <!-- ãƒšãƒ¼ã‚¸é·ç§»ç”¨JavaScript -->
  <script>
    // ãƒšãƒ¼ã‚¸é·ç§»æ©Ÿèƒ½ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    function setupPageTransitions() {
      const transitionOverlay = document.getElementById('page-transition-overlay');
      const pageContent = document.getElementById('page-content');
      
      console.log('Page transition setup:', { transitionOverlay, pageContent });
      
      // å‹•çš„ã«ãƒªãƒ³ã‚¯ã‚’å–å¾—ã—ã¦å‡¦ç†
      function attachTransitionToLinks() {
        const transitionLinks = document.querySelectorAll('.transition-link');
        console.log('Found transition links:', transitionLinks.length);
        
        transitionLinks.forEach((link, index) => {
          if (!link.hasAttribute('data-transition-attached')) {
            console.log(`Attaching transition to link ${index}:`, link.href);
            
            link.addEventListener('click', function(e) {
              const href = this.getAttribute('href');
              console.log('Link clicked:', href);
              
              // å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚„#ãƒªãƒ³ã‚¯ã¯é™¤å¤–
              if (!href || href.startsWith('#') || href.startsWith('http') || href.startsWith('mailto:') || href.startsWith('tel:')) {
                console.log('Excluded link type, normal navigation');
                return;
              }
              
              // Djangoã®å†…éƒ¨URLã®ã¿å‡¦ç†
              if (href.startsWith('/') || href.includes(window.location.hostname)) {
                e.preventDefault();
                console.log('Starting page transition...');
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°é–‹å§‹
                showPageTransition();
                
                // å°‘ã—é…å»¶ã—ã¦ãƒšãƒ¼ã‚¸é·ç§»
                setTimeout(() => {
                  console.log('Navigating to:', href);
                  window.location.href = href;
                }, 400);
              }
            });
            
            link.setAttribute('data-transition-attached', 'true');
          }
        });
      }
      
      // åˆå›å®Ÿè¡Œ
      attachTransitionToLinks();
      
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å®šç¾©ï¼‰
      window.showPageTransition = function() {
        console.log('Showing transition overlay...');
        if (transitionOverlay && pageContent) {
          // body ã«overflow hidden ã‚’è¿½åŠ 
          document.body.style.overflow = 'hidden';
          
          // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’è¡¨ç¤º
          transitionOverlay.classList.add('active');
          
          // ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
          setTimeout(() => {
            pageContent.classList.add('transitioning');
          }, 50);
          
          console.log('Transition overlay activated');
        } else {
          console.error('Missing elements:', { transitionOverlay, pageContent });
        }
      }
      
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤ºï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å®šç¾©ï¼‰
      window.hidePageTransition = function() {
        console.log('Hiding transition overlay...');
        if (transitionOverlay && pageContent) {
          transitionOverlay.classList.remove('active');
          pageContent.classList.remove('transitioning');
          document.body.style.overflow = '';
        }
      }
      
      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚
      window.addEventListener('load', () => {
        console.log('Page loaded, hiding transition');
        hidePageTransition();
      });
      
      // DOMContentLoadedå¾Œã‚‚å†åº¦ãƒã‚§ãƒƒã‚¯
      document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM loaded, hiding transition');
        hidePageTransition();
      });
      
      // ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯æ™‚ã®å‡¦ç†
      window.addEventListener('pageshow', function(e) {
        console.log('Page show event, persisted:', e.persisted);
        hidePageTransition();
      });
      
      // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚
      window.addEventListener('beforeunload', function() {
        console.log('Before unload');
        hidePageTransition();
      });
      
      // å‹•çš„ã«è¿½åŠ ã•ã‚ŒãŸãƒªãƒ³ã‚¯ã«ã‚‚å¯¾å¿œ
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'childList') {
            attachTransitionToLinks();
          }
        });
      });
      
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
      
      // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šæ‰‹å‹•ã§ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆ
      window.testTransition = function() {
        console.log('Manual transition test');
        showPageTransition();
        setTimeout(hidePageTransition, 2000);
      };
    }
    
    // æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸãƒªãƒ³ã‚¯ã«ã‚‚é·ç§»åŠ¹æœã‚’é©ç”¨
    function refreshPageTransitions() {
      setupPageTransitions();
    }
    
    // åˆæœŸåŒ–ã‚’å³åº§ã«å®Ÿè¡Œ
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupPageTransitions);
    } else {
      setupPageTransitions();
    }
  </script>

</body>
</html>
